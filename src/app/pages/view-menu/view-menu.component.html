<div class="container my-5">
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h2 class="mb-0"><i class="bi bi-card-list me-2"></i>Menu Items</h2>
                </div>
                <div class="card-body">
                    <!-- Error Message -->
                    <div class="alert alert-danger alert-dismissible fade show" *ngIf="errorMessage">
                        <i class="bi bi-exclamation-circle me-2"></i>{{ errorMessage }}
                        <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
                    </div>

                    <!-- Search and Filters -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <label for="search" class="form-label">Search</label>
                            <input type="text" class="form-control" id="search" [(ngModel)]="searchTerm"
                                (input)="onSearchChange()" placeholder="Search by name or description">
                        </div>
                        <div class="col-md-2">
                            <label for="categoryFilter" class="form-label">Category</label>
                            <select class="form-select" id="categoryFilter" [(ngModel)]="selectedCategory"
                                (change)="onFilterChange()">
                                <option *ngFor="let cat of categories" [value]="cat.value">{{ cat.label }}</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="typeFilter" class="form-label">Type</label>
                            <select class="form-select" id="typeFilter" [(ngModel)]="selectedType"
                                (change)="onFilterChange()">
                                <option *ngFor="let type of types" [value]="type.value">{{ type.label }}</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="statusFilter" class="form-label">Status</label>
                            <select class="form-select" id="statusFilter" [(ngModel)]="selectedStatus"
                                (change)="onFilterChange()">
                                <option *ngFor="let status of statuses" [value]="status.value">{{ status.label }}
                                </option>
                            </select>
                        </div>
                        <div class="col-md-3 d-flex align-items-end">
                            <button type="button" class="btn btn-outline-secondary me-2" (click)="clearFilters()">
                                <i class="bi bi-x-circle me-1"></i>Clear Filters
                            </button>
                            <button type="button" class="btn btn-primary" (click)="loadMenus()">
                                <i class="bi bi-arrow-clockwise me-1"></i>Refresh
                            </button>
                        </div>
                    </div>

                    <!-- Loading Spinner -->
                    <div class="text-center py-5" *ngIf="isLoading">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">Loading menu items...</p>
                    </div>

                    <!-- Menu Table -->
                    <div class="table-responsive" *ngIf="!isLoading">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Menu ID</th>
                                    <th>Name</th>
                                    <th>Description</th>
                                    <th>Price</th>
                                    <th>Category</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let menu of filteredMenus; trackBy: trackByMenuId">
                                    <td class="text-muted">{{ menu.menuId }}</td>
                                    <td class="fw-bold">{{ menu.menuName }}</td>
                                    <td>
                                        <span [title]="menu.description">
                                            {{ menu.description.length > 50 ? (menu.description | slice:0:50) + '...' :
                                            menu.description }}
                                        </span>
                                    </td>
                                    <td class="fw-bold text-success">${{ menu.price | number:'1.2-2' }}</td>
                                    <td>
                                        <span class="badge bg-info">{{ menu.category }}</span>
                                    </td>
                                    <td>
                                        <span [class]="getTypeBadgeClass(menu.menuType)">{{ menu.menuType === 'VEG' ?
                                            'Vegetarian' : 'Non-Vegetarian' }}</span>
                                    </td>
                                    <td>
                                        <button type="button" [class]="getStatusBadgeClass(menu.status)"
                                            (click)="toggleStatus(menu)" style="border: none; cursor: pointer;">
                                            {{ menu.status === 'AVAILABLE' ? 'Available' : 'Unavailable' }}
                                        </button>
                                    </td>
                                    <td>
                                        <div class="btn-group action-buttons" role="group">
                                            <button type="button" class="btn btn-sm btn-outline-primary btn-action"
                                                (click)="editMenu(menu)" title="Edit Menu" aria-label="Edit Menu">
                                                <i class="bi bi-pencil-square"></i>
                                                <span class="btn-text">Edit</span>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-outline-danger btn-action"
                                                (click)="deleteMenu(menu)" title="Delete Menu" aria-label="Delete Menu">
                                                <i class="bi bi-trash3"></i>
                                                <span class="btn-text">Delete</span>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr *ngIf="filteredMenus.length === 0">
                                    <td colspan="8" class="text-center py-4">
                                        <i class="bi bi-search text-muted mb-2" style="font-size: 2rem;"></i>
                                        <p class="text-muted mb-0">No menu items found matching your criteria.</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Results Count -->
                    <div class="d-flex justify-content-between align-items-center mt-3" *ngIf="!isLoading">
                        <small class="text-muted">
                            Showing {{ filteredMenus.length }} of {{ menus.length }} items
                        </small>
                        <a routerLink="/add-menu" class="btn btn-primary">
                            <i class="bi bi-plus-circle me-1"></i>Add New Menu Item
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-backdrop" *ngIf="showDeleteModal" (click)="closeDeleteModal()"></div>
<div class="modal custom-modal" [class.show]="showDeleteModal" *ngIf="showDeleteModal">
    <div class="modal-dialog modal-dialog-centered" (click)="$event.stopPropagation()">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title">
                    <i class="bi bi-exclamation-triangle text-warning me-2"></i>Confirm Delete
                </h5>
                <button type="button" class="btn-close" (click)="closeDeleteModal()" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="mb-3">Are you sure you want to delete this menu item?</p>
                <div class="alert alert-light border" *ngIf="menuToDelete">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-info-circle text-info me-2"></i>
                        <div>
                            <strong>{{ menuToDelete.menuName }}</strong>
                            <br>
                            <small class="text-muted">Price: ${{ menuToDelete.price | number:'1.2-2' }}</small>
                        </div>
                    </div>
                </div>
                <p class="text-danger small mb-0">
                    <i class="bi bi-exclamation-triangle me-1"></i>
                    This action cannot be undone.
                </p>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-outline-secondary" (click)="closeDeleteModal()">
                    <i class="bi bi-x-circle me-1"></i>Cancel
                </button>
                <button type="button" class="btn btn-danger" (click)="confirmDelete()">
                    <i class="bi bi-trash3 me-1"></i>Delete Item
                </button>
            </div>
        </div>
    </div>
</div>